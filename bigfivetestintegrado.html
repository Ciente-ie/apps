<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avaliação de Personalidade Big Five</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .custom-radio:checked {
            background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3ccircle cx='8' cy='8' r='3'/%3e%3c/svg%3e");
            border-color: #3b82f6;
            background-color: #3b82f6;
        }
    </style>
    <!-- FIREBASE INTEGRAÇÃO -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-app.js";
      import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.3.1/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDsoutLk5gmxq5zlu548HWFrox37u1zrxk",
        authDomain: "appintegrado-ciente.firebaseapp.com",
        projectId: "appintegrado-ciente",
        storageBucket: "appintegrado-ciente.appspot.com",
        messagingSenderId: "487559108410",
        appId: "1:487559108410:web:08868011454e609ee52203"
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      window.salvarBigFiveNoFirestore = async function(dadosBigFive) {
        try {
          const docRef = await addDoc(collection(db, "bigfive"), dadosBigFive);
          console.log("✅ Big Five salvo no Firebase! ID: " + docRef.id);
        } catch (erro) {
          console.error("❌ Erro ao salvar Big Five no Firebase:", erro.message);
        }
      };
    </script>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">Avaliação de Personalidade Big Five</h1>
            <p class="mt-2 text-md text-gray-600">Baseado no BFI-44 de John & Srivastava (1999)</p>
        </header>

        <main id="assessment-section" class="bg-white p-6 md:p-8 rounded-2xl shadow-lg">
            <div class="instructions mb-8">
                <h2 class="text-xl font-semibold mb-2 text-gray-800">Instruções</h2>
                <p class="mb-4 text-gray-700">A seguir encontram-se 44 características que lhe podem, ou não, dizer respeito. Por favor, escolha um dos números na escala que melhor expresse a sua opinião em relação a si mesmo. Não existem respostas certas, nem erradas!</p>
                <div class="flex flex-wrap justify-center text-center text-xs md:text-sm text-gray-600">
                    <span class="w-1/5 font-medium">1<br>Discordo<br>Totalmente</span>
                    <span class="w-1/5 font-medium">2<br>Discordo</span>
                    <span class="w-1/5 font-medium">3<br>Neutro</span>
                    <span class="w-1/5 font-medium">4<br>Concordo</span>
                    <span class="w-1/5 font-medium">5<br>Concordo<br>Totalmente</span>
                </div>
            </div>

            <!-- CAMPO NOME DO ATLETA -->
            <div class="mb-4">
              <label for="nomeAtleta" class="block font-semibold mb-2">Nome do Atleta (opcional):</label>
              <input type="text" id="nomeAtleta" name="nomeAtleta" class="border p-2 rounded w-full" placeholder="Digite o nome do atleta">
            </div>

            <form id="b5-form">
                <div id="questions-container" class="space-y-6">
                    <!-- As perguntas serão inseridas aqui pelo JavaScript -->
                </div>
                <div class="mt-8 text-center">
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg shadow-md transition-transform transform hover:scale-105">
                        Ver Resultados
                    </button>
                </div>
            </form>
        </main>

        <section id="results-section" class="hidden mt-10 bg-white p-6 md:p-8 rounded-2xl shadow-lg">
            <h2 class="text-2xl md:text-3xl font-bold text-center mb-6 text-gray-900">Seu Perfil de Personalidade</h2>
            <div class="mb-8 max-w-2xl mx-auto">
                <canvas id="results-chart"></canvas>
            </div>
            <div id="results-details" class="space-y-6">
                 <!-- Descrições dos resultados serão inseridas aqui -->
            </div>
             <div class="mt-8 text-center">
                <button id="restart-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-8 rounded-lg shadow-md transition-transform transform hover:scale-105">
                    Refazer Avaliação
                </button>
            </div>
        </section>

        <footer class="text-center mt-12 text-sm text-gray-500">
            <p>Este é um exercício para fins didáticos e de autoavaliação. Não substitui uma avaliação psicológica profissional.</p>
            <p>Adaptado do material de John, O. P., & Srivastava, S. (1999).</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const questions = [
                "É conversador, comunicativo", "Tende a ser crítico com os outros", "É minucioso e detalhista no trabalho", "É depressivo, triste", "É original, tem sempre novas ideias", "É reservado", "É prestativo e ajuda os outros", "Pode ser um tanto descuidado", "É relaxado, controla bem o stress", "É curioso sobre muitas coisas diferentes", "É cheio de energia", "Começa discussões, disputas, com os outros", "É um trabalhador de confiança", "Fica tenso com frequência", "É engenhoso, alguém que gosta de analisar profundamente as coisas", "Gera muito entusiasmo", "Tem capacidade de perdoar, perdoa facilmente", "Tende a ser desorganizado", "Preocupa-se muito com tudo", "Tem uma imaginação fértil", "Tende a ser quieto, calado", "É geralmente confiável", "Tende a ser preguiçoso", "É emocionalmente estável, não se altera facilmente", "É inventivo, criativo", "É assertivo, não teme expressar o que sente", "Às vezes é frio e distante", "Insiste até concluir a tarefa ou o trabalho", "É temperamental, muda de humor facilmente", "Valoriza o artístico, o estético", "É, às vezes, tímido e inibido", "É amável, tem consideração pelos outros", "Faz as coisas com eficiência", "Mantém-se calmo nas situações de tensão", "Prefere trabalho rotineiro", "É sociável, extrovertido", "É, às vezes, rude (grosseiro) com os outros", "Faz planos e segue-os à risca", "Fica nervoso facilmente", "Gosta de refletir, brincar com as ideias", "Tem poucos interesses artísticos", "Gosta de cooperar com os outros", "É facilmente distraído", "É sofisticado em artes, música ou literatura"
            ];

            const questionsContainer = document.getElementById('questions-container');
            questions.forEach((q, i) => {
                const questionIndex = i + 1;
                const questionBlock = document.createElement('div');
                questionBlock.className = 'question-item bg-gray-50 p-4 rounded-lg border border-gray-200';
                let questionHTML = `<p class="font-semibold text-gray-800 mb-2">${questionIndex}. Vejo-me como alguém que... ${q}</p>
                                    <div class="flex justify-around items-center pt-2">`;
                for (let j = 1; j <= 5; j++) {
                    questionHTML += `<label for="q${questionIndex}-${j}" class="cursor-pointer text-center p-2 rounded-md hover:bg-blue-50 flex flex-col items-center space-y-1 w-12">
                                        <span class="font-semibold text-gray-800">${j}</span>
                                        <input type="radio" name="q${questionIndex}" id="q${questionIndex}-${j}" value="${j}" class="custom-radio h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300" required>
                                     </label>`;
                }
                questionHTML += `</div>`;
                questionBlock.innerHTML = questionHTML;
                questionsContainer.appendChild(questionBlock);
            });

            const form = document.getElementById('b5-form');
            const restartBtn = document.getElementById('restart-btn');

            form.addEventListener('submit', (e) => {
                e.preventDefault();
                calculateResults();
            });

            restartBtn.addEventListener('click', () => {
                const resultsSection = document.getElementById('results-section');
                const assessmentSection = document.getElementById('assessment-section');
                resultsSection.classList.add('hidden');
                assessmentSection.classList.remove('hidden');
                form.reset();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            function calculateResults() {
                const formData = new FormData(form);
                const answers = {};
                let allAnswered = true;
                for(let i = 1; i <= questions.length; i++) {
                    const answer = formData.get(`q${i}`);
                    if (answer) {
                        answers[i] = parseInt(answer, 10);
                    } else {
                        allAnswered = false;
                        break;
                    }
                }

                if (!allAnswered) {
                    // Modal customizado para obrigar respostas
                    const modal = document.createElement('div');
                    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                    modal.innerHTML = `
                        <div class="bg-white p-8 rounded-lg shadow-2xl text-center">
                            <p class="text-lg font-medium mb-4">Por favor, responda a todas as perguntas.</p>
                            <button onclick="this.parentElement.parentElement.remove()" class="bg-blue-600 text-white px-6 py-2 rounded-lg">OK</button>
                        </div>
                    `;
                    document.body.appendChild(modal);
                    return;
                }

                const factorMap = {
                    'Extroversão': { items: [[1, false], [6, true], [11, false], [16, false], [21, true], [26, false], [31, true], [36, false]], description: 'Nível de conforto de uma pessoa com seus relacionamentos. Pessoas extrovertidas tendem a ser sociáveis, faladoras e assertivas, enquanto introvertidos são mais reservados e quietos.' },
                    'Amabilidade': { items: [[2, true], [7, false], [12, true], [17, false], [22, false], [27, true], [32, false], [37, true], [42, false]], description: 'Propensão de um indivíduo em acatar as ideias dos outros. Pessoas com alta amabilidade são cooperativas e confiáveis. As com baixa são mais críticas e antagonistas.' },
                    'Conscienciosidade': { items: [[3, false], [8, true], [13, false], [18, true], [23, true], [28, false], [33, false], [38, false], [43, true]], description: 'Medida de confiabilidade. Pessoas com alta conscienciosidade são responsáveis, organizadas e persistentes. As com baixa são mais desorganizadas e pouco confiáveis.' },
                    'Estabilidade Emocional': { items: [[4, true], [9, false], [14, true], [19, true], [24, false], [29, true], [34, false], [39, true]], description: 'Capacidade de uma pessoa em lidar com o estresse. Pessoas com alta estabilidade emocional (baixo neuroticismo) são calmas e seguras. As com baixa são mais nervosas e ansiosas.' },
                    'Abertura a Experiências': { items: [[5, false], [10, false], [15, false], [20, false], [25, false], [30, false], [35, true], [40, false], [41, true], [44, false]], description: 'Interesse de uma pessoa e seu fascínio por novidades. Pessoas abertas são criativas, curiosas e sensíveis artisticamente. As mais fechadas são convencionais e preferem o familiar.' }
                };

                const finalScores = {};
                for (const factor in factorMap) {
                    const { items } = factorMap[factor];
                    let scoreSum = 0;
                    items.forEach(([qNum, isInverted]) => {
                        const score = answers[qNum];
                        scoreSum += isInverted ? (6 - score) : score;
                    });
                    finalScores[factor] = scoreSum / items.length;
                }

                // ENVIA DADOS PARA O FIRESTORE
                const nomeAtleta = document.getElementById('nomeAtleta')?.value || "";
                const dadosParaFirebase = {
                    nome_atleta: nomeAtleta,
                    data: new Date().toISOString(),
                    extroversao: finalScores['Extroversão'],
                    amabilidade: finalScores['Amabilidade'],
                    conscienciosidade: finalScores['Conscienciosidade'],
                    estabilidade_emocional: finalScores['Estabilidade Emocional'],
                    abertura_experiencias: finalScores['Abertura a Experiências']
                };
                if (window.salvarBigFiveNoFirestore) {
                    window.salvarBigFiveNoFirestore(dadosParaFirebase);
                }

                displayResults(finalScores, factorMap);
            }

            let chartInstance = null;
            function displayResults(scores, factorMap) {
                const resultsSection = document.getElementById('results-section');
                const assessmentSection = document.getElementById('assessment-section');
                const labels = Object.keys(scores);
                const data = Object.values(scores);
                const ctx = document.getElementById('results-chart').getContext('2d');
                if(chartInstance) { chartInstance.destroy(); }
                chartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Sua Pontuação Média',
                            data: data.map(d => d.toFixed(2)),
                            backgroundColor: [
                                'rgba(54, 162, 235, 0.6)',
                                'rgba(75, 192, 192, 0.6)',
                                'rgba(255, 206, 86, 0.6)',
                                'rgba(255, 99, 132, 0.6)',
                                'rgba(153, 102, 255, 0.6)'
                            ],
                            borderColor: [
                                'rgba(54, 162, 235, 1)',
                                'rgba(75, 192, 192, 1)',
                                'rgba(255, 206, 86, 1)',
                                'rgba(255, 99, 132, 1)',
                                'rgba(153, 102, 255, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 5,
                                title: {
                                    display: true,
                                    text: 'Pontuação Média'
                                }
                            }
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `Pontuação: ${context.raw}`;
                                    }
                                }
                            }
                        }
                    }
                });
                const resultsDetails = document.getElementById('results-details');
                resultsDetails.innerHTML = '';
                for(const factor in scores) {
                    const score = scores[factor];
                    const { description } = factorMap[factor];
                    const detailHTML = `
                        <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                            <h3 class="text-lg font-bold text-gray-800">${factor}: <span class="text-blue-600">${score.toFixed(2)}</span></h3>
                            <p class="mt-1 text-gray-700">${description}</p>
                        </div>
                    `;
                    resultsDetails.innerHTML += detailHTML;
                }
                assessmentSection.classList.add('hidden');
                resultsSection.classList.remove('hidden');
                resultsSection.scrollIntoView({ behavior: 'smooth' });
            }
        });
    </script>
</body>
</html>
